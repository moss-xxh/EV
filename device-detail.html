<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备详情 - 移动充电</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        /* iPhone 外框 */
        .iphone-frame {
            width: 393px;
            height: 852px;
            background: #1a1a1a;
            border-radius: 55px;
            padding: 12px;
            box-shadow:
                0 0 0 2px #2a2a2a,
                0 0 0 8px #1a1a1a,
                0 30px 80px rgba(0, 0, 0, 0.5);
            position: relative;
            transform: scale(1.1);
            transform-origin: center;
        }

        /* 响应式缩放 */
        @media (max-height: 1000px) {
            .iphone-frame {
                transform: scale(0.95);
            }
        }

        @media (max-height: 900px) {
            .iphone-frame {
                transform: scale(0.85);
            }
        }

        @media (max-height: 800px) {
            .iphone-frame {
                transform: scale(0.75);
            }
        }

        /* 灵动岛 */
        .dynamic-island {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 126px;
            height: 37px;
            background: #000;
            border-radius: 22px;
            z-index: 10;
        }

        /* 屏幕内容 */
        .screen {
            width: 100%;
            height: 100%;
            background: #F5F5F5;
            border-radius: 45px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* 状态栏 */
        .status-bar {
            height: 54px;
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0 20px;
            padding-top: 16px;
            font-size: 15px;
            font-weight: 600;
            color: #000;
        }

        .time {
            font-weight: 600;
            position: absolute;
            left: 35px;
            top: 18px;
        }

        .status-icons {
            display: flex;
            gap: 6px;
            align-items: center;
            position: absolute;
            right: 35px;
            top: 18px;
        }

        /* 信号图标 */
        .signal {
            display: flex;
            gap: 1px;
            align-items: flex-end;
            height: 12px;
        }

        .signal-bar {
            width: 3px;
            background: #000;
            border-radius: 1px;
        }

        .signal-bar:nth-child(1) { height: 4px; }
        .signal-bar:nth-child(2) { height: 6px; }
        .signal-bar:nth-child(3) { height: 8px; }
        .signal-bar:nth-child(4) { height: 10px; }

        /* WiFi 图标 */
        .wifi {
            width: 15px;
            height: 11px;
            position: relative;
        }

        .wifi::before {
            content: '◗';
            font-size: 15px;
            color: #000;
            transform: rotate(45deg);
            display: block;
        }

        /* 电池图标 */
        .battery {
            width: 24px;
            height: 11px;
            border: 1.5px solid #000;
            border-radius: 3px;
            position: relative;
            margin-left: 5px;
            display: flex;
            align-items: center;
            padding: 2px;
        }

        .battery::before {
            content: '';
            position: absolute;
            right: -3px;
            top: 50%;
            transform: translateY(-50%);
            width: 1.5px;
            height: 4px;
            background: #000;
            border-radius: 0 1px 1px 0;
        }

        .battery::after {
            content: '';
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 1px;
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0 16px 110px 16px;
            -webkit-overflow-scrolling: touch;
        }

        /* 隐藏滚动条 */
        .main-content::-webkit-scrollbar {
            display: none;
        }

        .main-content {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 顶部导航栏容器 */
        .top-header-container {
            position: relative;
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            padding: 12px 0;
            min-height: 48px;
        }

        /* 返回按钮 */
        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: opacity 0.2s;
            z-index: 10;
        }

        .back-button:active {
            opacity: 0.6;
        }

        .back-icon {
            width: 24px;
            height: 24px;
        }

        .back-text {
            font-size: 17px;
            color: #0052CC;
            font-weight: 500;
        }

        /* 设备名称 - 绝对居中 */
        .device-name {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 22px;
            font-weight: 700;
            color: #000;
        }

        /* 旧的 detail-header 样式保留以防其他地方使用 */
        .detail-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 24px;
            padding: 8px 0;
            gap: 12px;
        }

        .connection-status {
            font-size: 13px;
            font-weight: 500;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .connection-status.connected {
            color: #34C759;
        }

        .connection-status.disconnected {
            color: #8E8E93;
        }

        .connection-status::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .connection-status.connected::before {
            background: #34C759;
            box-shadow: 0 0 6px rgba(52, 199, 89, 0.6);
        }

        .connection-status.disconnected::before {
            background: #8E8E93;
        }

        /* 未充电状态 */
        .not-charging-state {
            display: block;
        }

        .not-charging-state.hidden {
            display: none;
        }

        .status-card {
            background: #fff;
            border-radius: 20px;
            padding: 60px 24px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .status-icon {
            width: 80px;
            height: 80px;
            background: #F5F5F5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-text {
            font-size: 17px;
            color: #8E8E93;
            font-weight: 500;
        }

        .charge-btn-large {
            width: 100%;
            height: 56px;
            background: #0052CC;
            color: #fff;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 12px rgba(0, 82, 204, 0.2);
        }

        .charge-btn-large:active {
            transform: scale(0.98);
            background: #003B99;
        }

        .charge-btn-large:disabled {
            background: #E5E5EA;
            color: #8E8E93;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
        }

        .charge-btn-large:disabled:active {
            transform: none;
        }

        .charge-tip {
            font-size: 12px;
            color: #FF9500;
            text-align: center;
            margin-top: 12px;
            line-height: 1.4;
            padding: 0 8px;
        }

        .connection-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            padding: 20px;
            background: #F5F5F5;
            border-radius: 16px;
            gap: 12px;
        }

        .vehicle-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .vehicle-icon svg {
            width: 80px;
            height: 60px;
        }

        .connection-status-text {
            font-size: 15px;
            font-weight: 600;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .connection-status-text.connected {
            color: #34C759;
        }

        .connection-status-text.disconnected {
            color: #8E8E93;
        }

        .connection-status-text::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .connection-status-text.connected::before {
            background: #34C759;
            box-shadow: 0 0 8px rgba(52, 199, 89, 0.6);
        }

        .connection-status-text.disconnected::before {
            background: #8E8E93;
        }

        /* 充电中状态 */
        .charging-state {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0052CC 0%, #003B99 100%);
            z-index: 50;
            border-radius: 45px;
            overflow: hidden;
        }

        .charging-state.active {
            display: flex;
            flex-direction: column;
        }

        .charging-state.hidden {
            display: none;
        }

        /* 充电状态的状态栏 */
        .charging-status-bar {
            height: 54px;
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0 20px;
            padding-top: 16px;
            font-size: 15px;
            font-weight: 600;
            color: #fff;
            position: relative;
        }

        .charging-status-bar .time {
            font-weight: 600;
            position: absolute;
            left: 35px;
            top: 18px;
        }

        .charging-status-bar .status-icons {
            display: flex;
            gap: 6px;
            align-items: center;
            position: absolute;
            right: 35px;
            top: 18px;
        }

        .charging-status-bar .signal-bar {
            background: #fff;
        }

        .charging-status-bar .wifi::before {
            color: #fff;
        }

        .charging-status-bar .battery {
            border-color: #fff;
        }

        .charging-status-bar .battery::before {
            background: #fff;
        }

        .charging-status-bar .battery::after {
            background: #fff;
        }

        /* 充电状态顶部容器 */
        .charging-header {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px 16px 20px;
            min-height: 48px;
        }

        /* 充电状态的返回按钮（白色版本） */
        .charging-header .back-button {
            z-index: 10;
        }

        .charging-header .back-icon {
            stroke: #fff;
        }

        .charging-header .back-text {
            color: #fff;
        }

        /* 充电状态的设备名称 - 绝对居中 */
        .charging-device-name {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }

        .charging-connection-status {
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 4px;
            opacity: 0.9;
        }

        .charging-connection-status::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
        }

        /* 充电动画区域 */
        .charging-animation-area {
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            z-index: 30;
        }

        /* 汽车充电场景 */
        .charging-background {
            position: absolute;
            top: calc(50% - 10px);
            left: 50%;
            transform: translate(-50%, -50%) scale(1.2);
            width: 340px;
            height: 220px;
            opacity: 1;
            pointer-events: none;
            z-index: 31;
        }

        /* 隐藏圆圈和闪电 */
        .charging-circles-wrapper {
            display: none;
        }

        .charging-circle {
            position: absolute;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .charging-circle:nth-child(1) {
            width: 240px;
            height: 240px;
            animation: chargingPulse 3s ease-out infinite;
        }

        .charging-circle:nth-child(2) {
            width: 200px;
            height: 200px;
            animation: chargingPulse 3s ease-out infinite 0.5s;
        }

        .charging-circle:nth-child(3) {
            width: 160px;
            height: 160px;
            animation: chargingPulse 3s ease-out infinite 1s;
        }

        @keyframes chargingPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        .charging-icon-center {
            position: relative;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.25);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .charging-icon-center svg {
            width: 50px;
            height: 50px;
            fill: #fff;
        }

        /* 充电数据卡片 */
        .charging-data-card {
            background: #fff;
            border-radius: 24px 24px 0 0;
            padding: 24px 20px 140px;
            position: relative;
            margin-top: 20px;
            min-height: 220px;
            z-index: 10;
        }

        .charging-data-list {
            display: flex;
            flex-direction: row;
            gap: 12px;
            margin-bottom: 20px;
        }

        .data-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 12px;
            background: #F5F5F5;
            border-radius: 14px;
            gap: 6px;
        }

        .data-item:last-child {
            border-bottom: none;
        }

        .data-label {
            font-size: 13px;
            color: #8E8E93;
            font-weight: 500;
        }

        .data-value {
            font-size: 18px;
            font-weight: 700;
            color: #000;
            font-variant-numeric: tabular-nums;
        }

        .stop-btn-large {
            width: 100%;
            height: 50px;
            background: #fff;
            color: #FF3B30;
            border: 2px solid #FF3B30;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stop-btn-large:active {
            transform: scale(0.98);
            background: #FFEBEA;
        }

        /* 档位选择器 - 白色卡片内版本 */
        .gear-selector {
            padding: 0 0 20px 0;
            margin-bottom: 20px;
            position: relative;
            border-bottom: 1px solid #E5E5EA;
        }

        .gear-label-container {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 12px;
        }

        .gear-label {
            font-size: 15px;
            color: #000;
            font-weight: 600;
            text-align: left;
        }

        .gear-hint {
            font-size: 11px;
            color: #FF9500;
            font-weight: 500;
        }

        /* 大椭圆容器 - 分段控件样式 */
        .gear-options {
            display: flex;
            background: #F5F5F5;
            border-radius: 20px;
            padding: 3px;
            gap: 3px;
        }

        .gear-option {
            flex: 1;
            min-width: 0;
            padding: 8px 6px;
            background: transparent;
            border: none;
            border-radius: 17px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .gear-option:active {
            transform: scale(0.95);
        }

        .gear-option.selected {
            background: #0052CC;
            box-shadow: 0 2px 6px rgba(0, 82, 204, 0.25);
        }

        .gear-number {
            font-size: 15px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s ease;
        }

        .gear-option.selected .gear-number {
            color: #fff;
            font-weight: 700;
        }

        .hidden {
            display: none !important;
        }

        /* 底部菜单栏 */
        .bottom-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 22px;
            display: flex;
            justify-content: space-around;
            padding: 10px 16px;
            position: absolute;
            bottom: 25px;
            left: 16px;
            right: 16px;
            height: 70px;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            cursor: pointer;
            transition: all 0.25s ease;
            flex: 1;
        }

        .nav-item:active {
            transform: scale(0.88);
        }

        .nav-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
        }

        .nav-icon svg {
            width: 100%;
            height: 100%;
            stroke: #8E8E93;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: stroke 0.25s ease;
        }

        .nav-item.active .nav-icon svg {
            stroke: #0052CC;
            stroke-width: 2;
        }

        .nav-label {
            font-size: 11px;
            color: #8E8E93;
            font-weight: 500;
            transition: all 0.25s ease;
        }

        .nav-item.active .nav-label {
            color: #0052CC;
            font-weight: 600;
        }

        /* 底部指示条 */
        .home-indicator {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 5px;
            background: #000;
            border-radius: 3px;
            opacity: 0.3;
        }

        /* 确认对话框 */
        .confirm-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }

        .confirm-dialog-overlay.show {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .confirm-dialog {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 14px;
            width: 270px;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .dialog-content {
            padding: 20px 16px;
            text-align: center;
        }

        .dialog-title {
            font-size: 17px;
            font-weight: 600;
            color: #000;
            margin-bottom: 8px;
        }

        .dialog-message {
            font-size: 13px;
            color: #8E8E93;
            line-height: 1.4;
        }

        .dialog-buttons {
            display: flex;
            border-top: 0.5px solid rgba(0, 0, 0, 0.1);
        }

        .dialog-btn {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px;
            font-size: 17px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .dialog-btn:active {
            background: rgba(0, 0, 0, 0.05);
        }

        .dialog-btn-cancel {
            color: #0052CC;
            font-weight: 400;
            border-right: 0.5px solid rgba(0, 0, 0, 0.1);
        }

        .dialog-btn-confirm {
            color: #0052CC;
            font-weight: 600;
        }

        .dialog-btn-destructive {
            color: #FF3B30;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="iphone-frame">
        <!-- 灵动岛 -->
        <div class="dynamic-island"></div>

        <!-- 屏幕内容 -->
        <div class="screen">
            <!-- 状态栏 -->
            <div class="status-bar">
                <div class="time">9:41</div>
                <div class="status-icons">
                    <div class="signal">
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                    </div>
                    <div class="wifi"></div>
                    <div class="battery"></div>
                </div>
            </div>

            <!-- 主内容区 -->
            <div class="main-content">
                <!-- 顶部导航栏 -->
                <div class="top-header-container">
                    <!-- 返回按钮 -->
                    <div class="back-button" onclick="goBack()">
                        <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="#0052CC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        <span class="back-text">返回</span>
                    </div>
                    <!-- 设备名称 - 居中 -->
                    <div class="device-name" id="deviceName">CHG-001</div>
                </div>

                <!-- 未充电状态 -->
                <div class="not-charging-state" id="notChargingState">
                    <div class="status-card">
                        <div class="status-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48">
                                <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="none" stroke="#8E8E93" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="status-text">当前未充电</div>

                        <!-- 充电枪连接状态指示器 -->
                        <div class="connection-indicator">
                            <div class="vehicle-icon" onclick="toggleConnection()" style="cursor: pointer;">
                                <svg viewBox="0 0 100 70" fill="none">
                                    <defs>
                                        <!-- 车身金属渐变 -->
                                        <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:1" />
                                            <stop offset="30%" style="stop-color:#F5F5F5;stop-opacity:1" />
                                            <stop offset="70%" style="stop-color:#E8E8E8;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#D4D4D4;stop-opacity:1" />
                                        </linearGradient>

                                        <!-- 车窗玻璃渐变 -->
                                        <linearGradient id="windowGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#4A5568;stop-opacity:0.9" />
                                            <stop offset="100%" style="stop-color:#2D3748;stop-opacity:0.95" />
                                        </linearGradient>

                                        <!-- 轮胎渐变 -->
                                        <radialGradient id="tireGradient">
                                            <stop offset="0%" style="stop-color:#4B5563;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#1F2937;stop-opacity:1" />
                                        </radialGradient>
                                    </defs>

                                    <!-- 底部阴影 -->
                                    <ellipse cx="50" cy="62" rx="40" ry="3.5" fill="#000" opacity="0.2"/>

                                    <!-- 车身底部护板 -->
                                    <path d="M14 42 L82 42 L80 48 Q79 49 77 49 L19 49 Q17 49 16 48 Z" fill="#9CA3AF"/>
                                    <path d="M16 43 L80 43 L78 47 Q77.5 47.5 76 47.5 L20 47.5 Q18.5 47.5 18 47 Z" fill="#B8B8B8"/>

                                    <!-- 车身主体 - SUV造型 -->
                                    <path d="M16 42 L22 32 Q24 30 27 30 L69 30 Q72 30 74 32 L80 42 Z" fill="url(#bodyGradient)" stroke="#C0C0C0" stroke-width="0.5"/>

                                    <!-- 车身高光带 -->
                                    <path d="M22 32 L27 33 L65 33 L70 32" stroke="#FFFFFF" stroke-width="2" opacity="0.7" stroke-linecap="round"/>

                                    <!-- 车身腰线 -->
                                    <path d="M18 37 L78 37" stroke="#D1D5DB" stroke-width="0.8" opacity="0.6"/>

                                    <!-- 后部车身 - 倾斜设计 -->
                                    <path d="M69 30 L75 23 Q76 21 77 21 L79 21 L80 23 L80 30 Z" fill="url(#bodyGradient)" stroke="#C0C0C0" stroke-width="0.3"/>

                                    <!-- 车顶 -->
                                    <path d="M27 30 L33 19 Q35 16 38 16 L58 16 Q61 16 63 19 L69 30" fill="#E8E8E8" stroke="#C0C0C0" stroke-width="0.4"/>

                                    <!-- 车顶天窗条纹 -->
                                    <path d="M38 16 L58 16" stroke="#2D3748" stroke-width="2.5" opacity="0.6" stroke-linecap="round"/>

                                    <!-- 前挡风玻璃 -->
                                    <path d="M33 19 L38 16 L38 30 L33 30 Z" fill="url(#windowGradient)"/>
                                    <path d="M33 19 L38 16 L38 19" stroke="#6B7280" stroke-width="0.5" opacity="0.3" fill="none"/>

                                    <!-- 后挡风玻璃 -->
                                    <path d="M63 19 L69 30 L63 30 L58 16 Z" fill="url(#windowGradient)"/>

                                    <!-- A柱 -->
                                    <path d="M33 19 L38 16" stroke="#2D3748" stroke-width="1.2"/>

                                    <!-- 前侧车窗 -->
                                    <path d="M38 19 L43 17 L52 17 L52 30 L38 30 Z" fill="url(#windowGradient)"/>
                                    <path d="M38 20 L43 18 L52 18" stroke="#5A6B7F" stroke-width="0.4" opacity="0.4" fill="none"/>

                                    <!-- B柱 -->
                                    <path d="M52 17 L52 30" stroke="#2D3748" stroke-width="1.5"/>

                                    <!-- 后侧车窗 -->
                                    <path d="M56 17 L58 16 L63 19 L63 30 L56 30 Z" fill="url(#windowGradient)"/>

                                    <!-- C柱 -->
                                    <path d="M63 19 L63 30" stroke="#2D3748" stroke-width="1.2"/>

                                    <!-- 车窗框条 -->
                                    <path d="M38 30 L52 30 L56 30 L63 30" stroke="#4A5568" stroke-width="0.8"/>

                                    <!-- 后视镜 -->
                                    <ellipse cx="35" cy="28" rx="2.8" ry="3.5" fill="#4A5568"/>
                                    <ellipse cx="35.5" cy="28" rx="2" ry="2.5" fill="#5A6B7F"/>
                                    <ellipse cx="36" cy="27.5" rx="1" ry="1.5" fill="#CBD5E1" opacity="0.5"/>

                                    <!-- 前门把手 -->
                                    <ellipse cx="31" cy="37" rx="3.5" ry="1.2" fill="#9CA3AF"/>
                                    <ellipse cx="31" cy="37" rx="2.8" ry="0.9" fill="#B8B8B8"/>

                                    <!-- 后门把手 -->
                                    <ellipse cx="58" cy="37" rx="3.5" ry="1.2" fill="#9CA3AF"/>
                                    <ellipse cx="58" cy="37" rx="2.8" ry="0.9" fill="#B8B8B8"/>

                                    <!-- 前轮 - 真实轮毂 -->
                                    <circle cx="25" cy="49" r="8" fill="url(#tireGradient)"/>
                                    <circle cx="25" cy="49" r="6" fill="#374151"/>
                                    <circle cx="25" cy="49" r="3" fill="#4B5563"/>
                                    <!-- 轮毂辐条 - 5辐设计 -->
                                    <g transform="translate(25, 49)">
                                        <path d="M0,-5 L0,5 M-5,0 L5,0" stroke="#6B7280" stroke-width="1.2"/>
                                        <path d="M-3.5,-3.5 L3.5,3.5 M-3.5,3.5 L3.5,-3.5" stroke="#6B7280" stroke-width="1.2"/>
                                        <path d="M-4.5,-2 L4.5,2 M-4.5,2 L4.5,-2" stroke="#6B7280" stroke-width="0.8" opacity="0.6"/>
                                    </g>
                                    <circle cx="25" cy="49" r="1.5" fill="#9CA3AF"/>

                                    <!-- 后轮 - 真实轮毂 -->
                                    <circle cx="73" cy="49" r="8" fill="url(#tireGradient)"/>
                                    <circle cx="73" cy="49" r="6" fill="#374151"/>
                                    <circle cx="73" cy="49" r="3" fill="#4B5563"/>
                                    <!-- 轮毂辐条 - 5辐设计 -->
                                    <g transform="translate(73, 49)">
                                        <path d="M0,-5 L0,5 M-5,0 L5,0" stroke="#6B7280" stroke-width="1.2"/>
                                        <path d="M-3.5,-3.5 L3.5,3.5 M-3.5,3.5 L3.5,-3.5" stroke="#6B7280" stroke-width="1.2"/>
                                        <path d="M-4.5,-2 L4.5,2 M-4.5,2 L4.5,-2" stroke="#6B7280" stroke-width="0.8" opacity="0.6"/>
                                    </g>
                                    <circle cx="73" cy="49" r="1.5" fill="#9CA3AF"/>

                                    <!-- 前大灯组 -->
                                    <ellipse cx="14" cy="37" rx="3" ry="2.5" fill="#FEF3C7"/>
                                    <ellipse cx="14" cy="37" rx="2" ry="1.8" fill="#FFFFFF" opacity="0.9"/>
                                    <path d="M13 36.5 L15 36.5" stroke="#F59E0B" stroke-width="0.5" opacity="0.6"/>

                                    <!-- 尾灯组 - 红色醒目 -->
                                    <rect x="80" y="33" width="2.5" height="5" rx="0.6" fill="#DC2626"/>
                                    <rect x="80.3" y="33.5" width="2" height="4" rx="0.4" fill="#EF4444"/>
                                    <rect x="80.5" y="34" width="1.5" height="1.5" rx="0.3" fill="#FCA5A5" opacity="0.8"/>

                                    <!-- 充电口（车身后侧） -->
                                    <circle cx="76" cy="38" r="1.8" fill="#6B7280"/>
                                    <rect x="75" y="37" width="2" height="2" rx="0.4" fill="#10B981"/>
                                    <path d="M76 37.3 L75.5 38.3 L76.5 38.3 Z" fill="#FFFFFF" opacity="0.9"/>

                                    <!-- 车身反光高光 -->
                                    <ellipse cx="45" cy="34" rx="15" ry="2" fill="#FFFFFF" opacity="0.15"/>
                                </svg>
                            </div>
                            <span class="connection-status-text disconnected" id="connectionStatusText" onclick="handleConnectionTextClick()" style="cursor: pointer;">未连接</span>
                        </div>
                    </div>
                    <button class="charge-btn-large" id="startChargeBtn" onclick="startCharging()">Start Charging</button>
                    <div class="charge-tip">If no response when clicking, please go to i.charges app and select PLC mode</div>
                </div>

                <!-- 充电中状态 (全屏覆盖) -->
                <div class="charging-state hidden" id="chargingState">
                    <!-- 充电状态的状态栏 -->
                    <div class="charging-status-bar">
                        <div class="time">9:41</div>
                        <div class="status-icons">
                            <div class="signal">
                                <div class="signal-bar"></div>
                                <div class="signal-bar"></div>
                                <div class="signal-bar"></div>
                                <div class="signal-bar"></div>
                            </div>
                            <div class="wifi"></div>
                            <div class="battery"></div>
                        </div>
                    </div>

                    <!-- 顶部信息 -->
                    <div class="charging-header">
                        <!-- 返回按钮（白色版本） -->
                        <div class="back-button" onclick="goBack()">
                            <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                            </svg>
                            <span class="back-text">返回</span>
                        </div>
                        <!-- 设备名称 - 居中 -->
                        <div class="charging-device-name" id="chargingDeviceName">CHG-001</div>
                    </div>

                    <!-- 中间动画区域和档位选择器容器 -->
                    <div class="charging-animation-area">
                        <!-- 汽车充电场景 -->
                        <div class="charging-background">
                            <svg viewBox="0 -15 340 235" fill="none" xmlns="http://www.w3.org/2000/svg">

                                <!-- 汽车（左上角） -->
                                <g id="carGroup" transform="translate(10, 10)">
                                    <!-- 车身阴影 -->
                                    <ellipse cx="60" cy="75" rx="45" ry="5" fill="#000" opacity="0.15"/>

                                    <!-- 充电枪矩形背景容器 -->
                                    <rect x="25" y="5" width="70" height="50" rx="6"
                                          fill="none"
                                          stroke="#fff"
                                          stroke-width="1.5"
                                          opacity="0.6"/>

                                    <!-- 充电枪建模图片 -->
                                    <image x="30" y="10" width="60" height="40" href="充电枪建模.jpg" preserveAspectRatio="xMidYMid meet"/>

                                    <!-- 充电口（底部中央）-->
                                    <g transform="translate(60, 70)">
                                        <circle cx="0" cy="0" r="4" fill="#fff" opacity="1"/>
                                        <circle cx="0" cy="0" r="2.8" fill="#34C759" opacity="0.9">
                                            <animate attributeName="opacity" values="0.6;1;0.6" dur="1.5s" repeatCount="indefinite"/>
                                        </circle>
                                        <!-- 充电口强光晕 -->
                                        <circle cx="0" cy="0" r="6" fill="none" stroke="#FFD60A" stroke-width="2" opacity="0.6">
                                            <animate attributeName="r" values="6;10;6" dur="2s" repeatCount="indefinite"/>
                                            <animate attributeName="opacity" values="0.6;0;0.6" dur="2s" repeatCount="indefinite"/>
                                        </circle>
                                        <circle cx="0" cy="0" r="8" fill="none" stroke="#34C759" stroke-width="1.5" opacity="0.5">
                                            <animate attributeName="r" values="8;12;8" dur="2.2s" repeatCount="indefinite"/>
                                            <animate attributeName="opacity" values="0.5;0;0.5" dur="2.2s" repeatCount="indefinite"/>
                                        </circle>
                                    </g>

                                    <!-- 汽车电流标注 -->
                                    <text id="carCurrent" x="60" y="0" text-anchor="middle" fill="#fff" font-size="13" font-weight="700" opacity="0.95" style="pointer-events: none;">32A</text>
                                </g>

                                <!-- 空调（右上角） -->
                                <g id="houseGroup" transform="translate(220, 10)">
                                    <!-- 空调阴影 -->
                                    <ellipse cx="50" cy="75" rx="45" ry="5" fill="#000" opacity="0.15"/>

                                    <!-- 空调矩形背景容器 -->
                                    <rect x="15" y="5" width="70" height="50" rx="6"
                                          fill="none"
                                          stroke="#fff"
                                          stroke-width="1.5"
                                          opacity="0.6"/>

                                    <!-- 空调图片 -->
                                    <image x="20" y="10" width="60" height="40" href="空调.png" preserveAspectRatio="xMidYMid meet"/>

                                    <!-- 电源接入点（底部中央） -->
                                    <g transform="translate(50, 70)">
                                        <circle cx="0" cy="0" r="3" fill="#fff" opacity="1"/>
                                        <circle cx="0" cy="0" r="2" fill="#FFD60A" opacity="0.9">
                                            <animate attributeName="opacity" values="0.7;1;0.7" dur="1.5s" repeatCount="indefinite"/>
                                        </circle>
                                    </g>

                                    <!-- 空调电流标注 -->
                                    <text id="houseCurrent" x="50" y="0" text-anchor="middle" fill="#fff" font-size="13" font-weight="700" opacity="0.95" style="pointer-events: none;">31A</text>
                                </g>

                                <!-- 充电线缆 - 从汽车向下带圆角拐弯到充电桩 -->
                                <path d="M 70 80 L 70 165 Q 70 180, 85 180 L 162.5 180"
                                      stroke="#fff"
                                      stroke-width="4"
                                      fill="none"
                                      opacity="0.9"
                                      stroke-linecap="round"/>

                                <!-- 充电线缆光效 -->
                                <path d="M 70 80 L 70 165 Q 70 180, 85 180 L 162.5 180"
                                      stroke="#34C759"
                                      stroke-width="2"
                                      fill="none"
                                      opacity="0.5"
                                      stroke-linecap="round"/>

                                <!-- 能量粒子流动 - 从充电桩到汽车 -->
                                <g>
                                    <!-- 粒子1 -->
                                    <circle r="3" fill="#34C759" opacity="0.9">
                                        <animateMotion dur="2s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子2 -->
                                    <circle r="2.5" fill="#34C759" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.3s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.3s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子3 -->
                                    <circle r="3.5" fill="#34C759" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.45s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.45s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子4 -->
                                    <circle r="2.8" fill="#34C759" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.6s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.6s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子5 -->
                                    <circle r="3.2" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.75s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.75s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子6 -->
                                    <circle r="2.8" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.9s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.9s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子7 -->
                                    <circle r="3" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2s" begin="1.2s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="1.2s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子8 -->
                                    <circle r="2.6" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2s" begin="0.15s" repeatCount="indefinite" path="M 162.5 180 L 85 180 Q 70 180, 70 165 L 70 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2s" begin="0.15s" repeatCount="indefinite"/>
                                    </circle>
                                </g>

                                <!-- 电源线缆 - 从房子向下带圆角拐弯到充电桩 -->
                                <path d="M 270 80 L 270 165 Q 270 180, 255 180 L 172.5 180"
                                      stroke="#fff"
                                      stroke-width="4"
                                      fill="none"
                                      opacity="0.9"
                                      stroke-linecap="round"/>

                                <!-- 电源线缆光效 -->
                                <path d="M 270 80 L 270 165 Q 270 180, 255 180 L 172.5 180"
                                      stroke="#FFD60A"
                                      stroke-width="2"
                                      fill="none"
                                      opacity="0.5"
                                      stroke-linecap="round"/>

                                <!-- 能量粒子流动 - 从充电桩到房子 -->
                                <g>
                                    <!-- 粒子1 -->
                                    <circle r="3" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2.5s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子2 -->
                                    <circle r="2.5" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="0.4s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="0.4s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子3 -->
                                    <circle r="3.5" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="0.8s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="0.8s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子4 -->
                                    <circle r="2.8" fill="#FFD60A" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="1.2s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="1.2s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子5 -->
                                    <circle r="3.2" fill="#FFA500" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="0.2s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="0.2s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子6 -->
                                    <circle r="2.8" fill="#FFA500" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="0.6s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="0.6s" repeatCount="indefinite"/>
                                    </circle>
                                    <!-- 粒子7 -->
                                    <circle r="3" fill="#FFA500" opacity="0.9">
                                        <animateMotion dur="2.5s" begin="1.0s" repeatCount="indefinite" path="M 172.5 180 L 255 180 Q 270 180, 270 165 L 270 80"/>
                                        <animate attributeName="opacity" values="0;1;1;0" dur="2.5s" begin="1.0s" repeatCount="indefinite"/>
                                    </circle>
                                </g>

                                <!-- 充电桩（中间底部） - N3正视图 -->
                                <g transform="translate(117.5, 120)">
                                    <!-- 桩体阴影 -->
                                    <ellipse cx="50" cy="135" rx="35" ry="4" fill="#000" opacity="0.15"/>

                                    <!-- N3正视图图片 -->
                                    <image x="27" y="25" width="46" height="74" href="N3.jpg" preserveAspectRatio="xMidYMid meet"/>

                                    <!-- 充电桩电流标注 -->
                                    <text id="pileCurrent" x="50" y="12" text-anchor="middle" fill="#fff" font-size="13" font-weight="700" opacity="0.95">63A</text>
                                </g>
                            </svg>
                        </div>

                        <div class="charging-circles-wrapper">
                            <div class="charging-circle"></div>
                            <div class="charging-circle"></div>
                            <div class="charging-circle"></div>
                            <div class="charging-icon-center">
                                <svg viewBox="0 0 24 24">
                                    <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z"/>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- 底部数据卡片 -->
                    <div class="charging-data-card">
                        <!-- 档位选择器（在白色卡片内） -->
                        <div class="gear-selector">
                            <div class="gear-label-container">
                                <div class="gear-label">入户电流</div>
                                <div class="gear-hint">请根据空开电流设置。过高电流可能造成跳闸</div>
                            </div>
                            <div class="gear-options">
                                <div class="gear-option" data-gear="1" onclick="selectGear(1)">
                                    <div class="gear-number">20</div>
                                </div>
                                <div class="gear-option" data-gear="2" onclick="selectGear(2)">
                                    <div class="gear-number">25</div>
                                </div>
                                <div class="gear-option selected" data-gear="3" onclick="selectGear(3)">
                                    <div class="gear-number">32</div>
                                </div>
                                <div class="gear-option" data-gear="4" onclick="selectGear(4)">
                                    <div class="gear-number">40</div>
                                </div>
                                <div class="gear-option" data-gear="5" onclick="selectGear(5)">
                                    <div class="gear-number">50</div>
                                </div>
                                <div class="gear-option" data-gear="6" onclick="selectGear(6)">
                                    <div class="gear-number">63</div>
                                </div>
                            </div>
                        </div>

                        <div class="charging-data-list">
                            <div class="data-item">
                                <div class="data-label">充电时长</div>
                                <div class="data-value" id="chargingDuration">00:00:00</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">充电量</div>
                                <div class="data-value" id="chargedEnergy">0 kWh</div>
                            </div>
                        </div>

                        <button class="stop-btn-large" onclick="stopCharging()">Stop Charging</button>
                        <div class="charge-tip">If no response when clicking, please go to i.charges app and select PLC mode</div>
                    </div>
                </div>
            </div>

            <!-- 底部菜单栏 -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="navigateTo('search')">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                    </div>
                    <div class="nav-label">充电桩</div>
                </div>
                <div class="nav-item" onclick="navigateTo('record')">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </div>
                    <div class="nav-label">记录</div>
                </div>
                <div class="nav-item" onclick="navigateTo('me')">
                    <div class="nav-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="8" r="5"/>
                            <path d="M3 21v-2a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v2"/>
                        </svg>
                    </div>
                    <div class="nav-label">我的</div>
                </div>
            </div>

            <!-- 底部指示条 -->
            <div class="home-indicator"></div>
        </div>
    </div>

    <!-- 确认对话框 -->
    <div class="confirm-dialog-overlay" id="confirmDialog">
        <div class="confirm-dialog">
            <div class="dialog-content">
                <div class="dialog-title" id="dialogTitle">确认操作</div>
                <div class="dialog-message" id="dialogMessage">确定要执行此操作吗？</div>
            </div>
            <div class="dialog-buttons">
                <button class="dialog-btn dialog-btn-cancel" onclick="hideDialog()">取消</button>
                <button class="dialog-btn dialog-btn-confirm" id="dialogConfirmBtn" onclick="confirmAction()">确认</button>
            </div>
        </div>
    </div>

    <script>
        // 多语言配置
        const i18n = {
            '中文': {
                connected: '蓝牙已连接',
                disconnected: '未连接',
                chargerConnected: '充电枪已连接',
                chargerDisconnected: '充电枪未连接',
                notCharging: '当前未充电',
                startCharging: '开始充电',
                startingTitle: '正在启动',
                startingMsg: '充电系统正在启动中...',
                duration: '充电时长',
                energy: '充电量',
                startTime: '开始时间',
                stopCharging: '结束充电',
                navDevice: '设备',
                navSearch: '充电枪',
                navRecord: '记录',
                navMe: '我的',
                confirmStop: '停止充电',
                confirmStopMsg: '确定要停止充电吗？',
                stop: '停止',
                notConnectedTitle: '充电桩未连接',
                notConnectedMsg: '请先将充电枪连接到车辆',
                ok: '知道了',
                disconnectTitle: '断开连接',
                disconnectMsg: '确定要断开与设备的连接吗？',
                disconnect: '断开',
                cancel: '取消',
                chargingCurrent: '入户电流',
                currentWarning: '请根据空开电流设置。过高电流可能造成跳闸',
                back: '返回',
                chargeTip: '如果点击无反应请前往i.charges app选择模式为plc'
            },
            '繁體中文': {
                connected: '藍牙已連接',
                disconnected: '未連接',
                chargerConnected: '充電槍已連接',
                chargerDisconnected: '充電槍未連接',
                notCharging: '當前未充電',
                startCharging: '開始充電',
                startingTitle: '正在啟動',
                startingMsg: '充電系統正在啟動中...',
                duration: '充電時長',
                energy: '充電量',
                startTime: '開始時間',
                stopCharging: '結束充電',
                navDevice: '設備',
                navSearch: '充電槍',
                navRecord: '記錄',
                navMe: '我的',
                confirmStop: '停止充電',
                confirmStopMsg: '確定要停止充電嗎？',
                stop: '停止',
                notConnectedTitle: '充電樁未連接',
                notConnectedMsg: '請先將充電槍連接到車輛',
                ok: '知道了',
                disconnectTitle: '斷開連接',
                disconnectMsg: '確定要斷開與設備的連接嗎？',
                disconnect: '斷開',
                cancel: '取消',
                chargingCurrent: '入戶電流',
                currentWarning: '請根據空開電流設置。過高電流可能造成跳閘',
                back: '返回',
                chargeTip: '如果點擊無反應請前往i.charges app選擇模式為plc'
            },
            'English': {
                connected: 'Bluetooth Connected',
                disconnected: 'Disconnected',
                chargerConnected: 'Charger Connected',
                chargerDisconnected: 'Charger Disconnected',
                notCharging: 'Not Charging',
                startCharging: 'Start Charging',
                startingTitle: 'Starting',
                startingMsg: 'Charging system is starting...',
                duration: 'Duration',
                energy: 'Energy',
                startTime: 'Start Time',
                stopCharging: 'Stop Charging',
                navDevice: 'Devices',
                navSearch: 'Charger',
                navRecord: 'Records',
                navMe: 'Me',
                confirmStop: 'Stop Charging',
                confirmStopMsg: 'Are you sure you want to stop charging?',
                stop: 'Stop',
                notConnectedTitle: 'Charger Not Connected',
                notConnectedMsg: 'Please connect the charging cable to the vehicle first',
                ok: 'OK',
                disconnectTitle: 'Disconnect',
                disconnectMsg: 'Are you sure you want to disconnect from the device?',
                disconnect: 'Disconnect',
                cancel: 'Cancel',
                chargingCurrent: 'Incoming Current',
                currentWarning: 'Please set according to circuit breaker rating. High current may cause circuit breaker to trip',
                back: 'Back',
                chargeTip: 'If no response when clicking, please go to i.charges app and select PLC mode'
            }
        };

        // 更新界面语言
        function updateLanguage(lang) {
            const texts = i18n[lang];
            if (!texts) return;

            // 更新连接状态 - 根据实际连接状态显示文本
            updateConnectionStatusText(lang);

            // 更新未充电状态文本
            const statusText = document.querySelector('.status-text');
            if (statusText) statusText.textContent = texts.notCharging;

            // 更新按钮文本
            const startChargingBtn = document.querySelector('.charge-btn-large');
            if (startChargingBtn) startChargingBtn.textContent = texts.startCharging;

            const stopChargingBtn = document.querySelector('.stop-btn-large');
            if (stopChargingBtn) stopChargingBtn.textContent = texts.stopCharging;

            // 更新充电数据标签
            const dataLabels = document.querySelectorAll('.data-label');
            if (dataLabels.length >= 2) {
                dataLabels[0].textContent = texts.duration;
                dataLabels[1].textContent = texts.energy;
            }

            // 更新导航标签
            const navLabels = document.querySelectorAll('.nav-label');
            if (navLabels.length >= 3) {
                navLabels[0].textContent = texts.navSearch;  // 充电桩
                navLabels[1].textContent = texts.navRecord;  // 记录
                navLabels[2].textContent = texts.navMe;      // 我的
            }

            // 更新对话框取消按钮
            const cancelBtn = document.querySelector('.dialog-btn-cancel');
            if (cancelBtn) cancelBtn.textContent = texts.cancel;

            // 更新充电界面的蓝牙连接状态
            const chargingConnectionStatus = document.getElementById('chargingConnectionStatus');
            if (chargingConnectionStatus) {
                chargingConnectionStatus.textContent = texts.connected;
            }

            // 更新充电电流标签
            const gearLabel = document.querySelector('.gear-label');
            if (gearLabel) gearLabel.textContent = texts.chargingCurrent;

            // 更新电流警告提示
            const gearHint = document.querySelector('.gear-hint');
            if (gearHint) gearHint.textContent = texts.currentWarning;

            // 更新返回按钮文本
            const backTexts = document.querySelectorAll('.back-text');
            backTexts.forEach(backText => {
                backText.textContent = texts.back;
            });

            // 更新充电提示文字（所有实例）
            const chargeTips = document.querySelectorAll('.charge-tip');
            chargeTips.forEach(tip => {
                tip.textContent = texts.chargeTip;
            });
        }

        // 车辆连接状态（默认模拟为已连接）- 必须在 updateLanguage 之前定义
        let isVehicleConnected = true;

        // 充电状态
        let isCharging = false;
        let currentChargeStartTime = null;
        let chargingTimer = null;
        let currentGear = 3; // 默认3档

        // 对话框回调函数
        let dialogCallback = null;

        // 档位电流配置 (A)
        const gearCurrents = {
            1: 20,
            2: 25,
            3: 32,
            4: 40,
            5: 50,
            6: 63
        };

        // 档位功率配置 (kW)
        const gearPowers = {
            1: 3.5,
            2: 7,
            3: 11,
            4: 22,
            5: 40,
            6: 60
        };

        // 选择档位
        function selectGear(gear) {
            currentGear = gear;

            // 更新UI
            document.querySelectorAll('.gear-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.gear-option[data-gear="${gear}"]`).classList.add('selected');

            // 如果正在充电,更新localStorage中的档位信息
            if (isCharging) {
                const chargingStatusStr = localStorage.getItem('chargingStatus');
                if (chargingStatusStr) {
                    try {
                        const chargingData = JSON.parse(chargingStatusStr);
                        chargingData.gear = gear;
                        localStorage.setItem('chargingStatus', JSON.stringify(chargingData));
                    } catch (error) {
                        console.error('更新档位失败:', error);
                    }
                }
            }

            console.log('切换到档位:', gear, '功率:', gearPowers[gear], 'kW', '电流:', gearCurrents[gear], 'A');

            // 如果正在充电，立即更新电流显示
            if (isCharging) {
                updateCurrentDisplay();
            }
        }

        // 从URL参数获取设备信息
        const urlParams = new URLSearchParams(window.location.search);
        const deviceID = urlParams.get('id') || 'CHG-001';

        // 填充设备信息
        document.getElementById('deviceName').textContent = deviceID;
        document.getElementById('chargingDeviceName').textContent = deviceID;

        // 页面加载时恢复语言设置
        const savedLanguage = localStorage.getItem('preferredLanguage') || 'English';
        // 无论什么语言都应该应用一次，确保所有文本正确显示
        updateLanguage(savedLanguage);

        // 监听其他页面的语言变更（跨页面语言切换）
        window.addEventListener('storage', function(e) {
            if (e.key === 'preferredLanguage' && e.newValue) {
                updateLanguage(e.newValue);
            }
        });

        // 更新连接状态显示
        function updateConnectionStatusText(lang) {
            const texts = i18n[lang || savedLanguage];
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionStatusText = document.getElementById('connectionStatusText');
            const startChargeBtn = document.getElementById('startChargeBtn');

            if (connectionStatus) {
                if (isVehicleConnected) {
                    connectionStatus.textContent = texts.connected;
                    connectionStatus.className = 'connection-status connected';
                } else {
                    connectionStatus.textContent = texts.disconnected;
                    connectionStatus.className = 'connection-status disconnected';
                }
            }

            if (connectionStatusText) {
                if (isVehicleConnected) {
                    connectionStatusText.textContent = texts.chargerConnected;
                    connectionStatusText.className = 'connection-status-text connected';
                } else {
                    connectionStatusText.textContent = texts.chargerDisconnected;
                    connectionStatusText.className = 'connection-status-text disconnected';
                }
            }

            // 同步按钮状态：未连接时禁用充电按钮
            if (startChargeBtn) {
                startChargeBtn.disabled = !isVehicleConnected;
            }
        }

        // 切换连接状态（测试功能）
        function toggleConnection() {
            isVehicleConnected = !isVehicleConnected;
            updateConnectionStatusText(savedLanguage);
            console.log('连接状态切换为:', isVehicleConnected ? '已连接' : '未连接');
        }

        // 处理连接状态文本点击事件
        function handleConnectionTextClick() {
            // 只有在已连接状态下才跳转
            if (isVehicleConnected) {
                window.location.href = 'search.html';
            }
        }

        // 初始化页面时更新状态
        updateConnectionStatusText(savedLanguage);

        // 页面加载时检查并恢复充电状态
        function restoreChargingState() {
            const chargingStatusStr = localStorage.getItem('chargingStatus');
            if (!chargingStatusStr) return;

            try {
                const chargingData = JSON.parse(chargingStatusStr);

                // 检查是否是当前设备的充电状态
                if (chargingData.deviceID !== deviceID) return;

                // 检查充电状态是否有效
                if (chargingData.isCharging && chargingData.startTime) {
                    isCharging = true;
                    currentChargeStartTime = new Date(chargingData.startTime);

                    // 恢复档位
                    if (chargingData.gear) {
                        currentGear = chargingData.gear;
                        selectGear(currentGear);
                    }

                    // 切换UI状态 - 显示充电界面
                    document.getElementById('chargingState').classList.remove('hidden');
                    document.getElementById('chargingState').classList.add('active');

                    // 立即更新一次充电数据
                    updateChargingData();

                    // 开始定时更新充电数据
                    chargingTimer = setInterval(updateChargingData, 1000);

                    // 立即更新电流显示
                    updateCurrentDisplay();

                    console.log('恢复充电状态，开始时间:', currentChargeStartTime, '档位:', currentGear);
                }
            } catch (error) {
                console.error('恢复充电状态失败:', error);
                localStorage.removeItem('chargingStatus');
            }
        }

        // 执行恢复充电状态
        restoreChargingState();

        // 显示确认对话框（两个按钮：取消和确认）
        function showDialog(title, message, confirmText, callback, isDestructive = false) {
            document.getElementById('dialogTitle').textContent = title;
            document.getElementById('dialogMessage').textContent = message;

            const confirmBtn = document.getElementById('dialogConfirmBtn');
            confirmBtn.textContent = confirmText;

            // 设置按钮样式（普通或破坏性）
            if (isDestructive) {
                confirmBtn.className = 'dialog-btn dialog-btn-destructive';
            } else {
                confirmBtn.className = 'dialog-btn dialog-btn-confirm';
            }

            // 显示取消按钮
            const cancelBtn = document.querySelector('.dialog-btn-cancel');
            if (cancelBtn) cancelBtn.style.display = 'block';

            dialogCallback = callback;
            document.getElementById('confirmDialog').classList.add('show');
        }

        // 显示信息对话框（只有一个确定按钮）
        function showInfoDialog(title, message, okText, callback) {
            document.getElementById('dialogTitle').textContent = title;
            document.getElementById('dialogMessage').textContent = message;

            const confirmBtn = document.getElementById('dialogConfirmBtn');
            confirmBtn.textContent = okText;
            confirmBtn.className = 'dialog-btn dialog-btn-confirm';

            // 隐藏取消按钮
            const cancelBtn = document.querySelector('.dialog-btn-cancel');
            if (cancelBtn) cancelBtn.style.display = 'none';

            dialogCallback = callback;
            document.getElementById('confirmDialog').classList.add('show');
        }

        // 隐藏对话框
        function hideDialog() {
            document.getElementById('confirmDialog').classList.remove('show');
            dialogCallback = null;
            // 恢复取消按钮显示
            const cancelBtn = document.querySelector('.dialog-btn-cancel');
            if (cancelBtn) cancelBtn.style.display = 'block';
        }

        // 确认操作
        function confirmAction() {
            if (dialogCallback) {
                dialogCallback();
            }
            hideDialog();
        }

        // 开始充电
        function startCharging() {
            if (isCharging) return;

            // 检查车辆是否已连接
            if (!isVehicleConnected) {
                const texts = i18n[savedLanguage];
                showInfoDialog(
                    texts.notConnectedTitle,
                    texts.notConnectedMsg,
                    texts.ok,
                    null
                );
                return;
            }

            // 显示"正在启动中"提示
            const texts = i18n[savedLanguage];
            showInfoDialog(
                texts.startingTitle,
                texts.startingMsg,
                '',
                null
            );

            // 延迟1.5秒后开始充电
            setTimeout(() => {
                hideDialog();

                isCharging = true;
                currentChargeStartTime = new Date();

                // 保存充电状态到 localStorage (包含档位信息)
                const chargingData = {
                    isCharging: true,
                    startTime: currentChargeStartTime.toISOString(),
                    deviceID: deviceID,
                    gear: currentGear
                };
                localStorage.setItem('chargingStatus', JSON.stringify(chargingData));

                // 切换UI状态 - 充电状态覆盖整个屏幕
                document.getElementById('chargingState').classList.remove('hidden');
                document.getElementById('chargingState').classList.add('active');

                // 开始更新充电数据
                updateChargingData();
                chargingTimer = setInterval(updateChargingData, 1000);

                // 立即更新电流显示
                updateCurrentDisplay();

                console.log('开始充电...');
            }, 1500);
        }

        // 更新充电数据
        function updateChargingData() {
            if (!isCharging || !currentChargeStartTime) return;

            const now = new Date();
            const durationSeconds = Math.floor((now - currentChargeStartTime) / 1000);
            const durationMinutes = Math.floor(durationSeconds / 60);

            // 更新时长显示 (HH:MM:SS 格式)
            const hours = Math.floor(durationSeconds / 3600);
            const minutes = Math.floor((durationSeconds % 3600) / 60);
            const seconds = durationSeconds % 60;
            const durationText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('chargingDuration').textContent = durationText;

            // 模拟充电量增长（根据档位功率计算，限制在10-20kWh范围）
            // 使用当前档位功率（kW）计算每分钟充电量
            const powerKW = gearPowers[currentGear];
            const chargedEnergyRaw = (durationMinutes / 60) * powerKW; // 实际充电量
            // 限制在10-20kWh范围内
            const chargedEnergy = Math.min(20, Math.max(10, chargedEnergyRaw));
            document.getElementById('chargedEnergy').textContent = `${chargedEnergy.toFixed(1)} kWh`;

            // 更新实时电流显示
            updateCurrentDisplay();
        }

        // 更新实时电流显示
        function updateCurrentDisplay() {
            // 汽车实际电流 = 档位设置电流 - (1到2的随机值)
            const gearCurrent = gearCurrents[currentGear];
            const carCurrentReduction = 1 + Math.random(); // 1-2之间的随机数
            const carCurrent = Math.round((gearCurrent - carCurrentReduction) * 10) / 10; // 保留一位小数

            // 房子电流在 14-16A 之间变动（家用负载）
            const houseCurrentVariation = 14 + Math.random() * 2; // 14-16之间的随机数
            const houseCurrent = Math.round(houseCurrentVariation * 10) / 10; // 保留一位小数

            // 充电桩总电流 = 汽车电流 + 房子电流
            const totalCurrent = carCurrent + houseCurrent;

            // 更新SVG中的电流文本
            const pileCurrentEl = document.getElementById('pileCurrent');
            const carCurrentEl = document.getElementById('carCurrent');
            const houseCurrentEl = document.getElementById('houseCurrent');

            if (pileCurrentEl) pileCurrentEl.textContent = `${totalCurrent.toFixed(1)}A`;
            if (carCurrentEl) carCurrentEl.textContent = `${carCurrent.toFixed(1)}A`;
            if (houseCurrentEl) houseCurrentEl.textContent = `${houseCurrent.toFixed(1)}A`;

            // 更新天平效果
            updateBalanceEffect(carCurrent, houseCurrent);
        }

        // 更新天平效果
        function updateBalanceEffect(carCurrent, houseCurrent) {
            const carGroup = document.getElementById('carGroup');
            const houseGroup = document.getElementById('houseGroup');

            if (!carGroup || !houseGroup) return;

            // 计算电流差异，产生轻微位移（最大±3像素）
            const currentDiff = carCurrent - houseCurrent;
            const maxOffset = 3;

            // 根据电流差异计算偏移量
            // 电流大的向下，电流小的向上
            const carOffset = Math.min(maxOffset, Math.max(-maxOffset, currentDiff * 0.1));
            const houseOffset = -carOffset;

            // 移除之前的动画，重新设置transform
            carGroup.style.animation = 'none';
            houseGroup.style.animation = 'none';

            // 应用天平效果的位移
            carGroup.style.transition = 'transform 0.5s ease';
            houseGroup.style.transition = 'transform 0.5s ease';

            carGroup.style.transform = `translate(10px, ${10 + carOffset}px)`;
            houseGroup.style.transform = `translate(220px, ${10 + houseOffset}px)`;
        }

        // 停止充电
        function stopCharging() {
            if (!isCharging) return;

            const texts = i18n[savedLanguage];
            showDialog(
                texts.confirmStop,
                texts.confirmStopMsg,
                texts.stop,
                function() {
                    executeStopCharging();
                },
                true  // 破坏性操作，使用红色
            );
        }

        // 执行停止充电
        function executeStopCharging() {
            try {
                console.log('=== 开始执行停止充电 ===');

                // 检查开始时间是否有效
                if (!currentChargeStartTime) {
                    console.error('充电开始时间无效，使用当前时间');
                    currentChargeStartTime = new Date();
                }

                // 计算充电时长和电量
                const endTime = new Date();
                const durationMinutes = Math.floor((endTime - currentChargeStartTime) / 1000 / 60);

                // 根据当前档位计算充电量
                const powerKW = gearPowers[currentGear];
                const chargedEnergyRaw = (durationMinutes / 60) * powerKW;
                const chargedEnergy = Math.min(20, Math.max(10, chargedEnergyRaw)).toFixed(1);

                // 获取开始时间信息
                const startDate = currentChargeStartTime.toISOString().split('T')[0];
                const startHour = String(currentChargeStartTime.getHours()).padStart(2, '0');
                const startMinute = String(currentChargeStartTime.getMinutes()).padStart(2, '0');
                const startTime = `${startHour}:${startMinute}`;

                console.log(`充电数据: 时长=${durationMinutes}分钟, 电量=${chargedEnergy}kWh, 日期=${startDate}, 时间=${startTime}`);

                // 构建跳转URL
                const detailUrl = `charge-record-detail-copy.html?charger=${encodeURIComponent(deviceID)}&date=${startDate}&time=${startTime}&duration=${durationMinutes}&energy=${chargedEnergy}`;
                console.log('跳转URL:', detailUrl);

                // 停止充电状态
                isCharging = false;
                if (chargingTimer) {
                    clearInterval(chargingTimer);
                    chargingTimer = null;
                }
                localStorage.removeItem('chargingStatus');

                // 立即跳转
                window.location.href = detailUrl;
            } catch (error) {
                console.error('停止充电时发生错误:', error);
                // 即使发生错误也尝试跳转到空白记录页
                window.location.href = 'charge-record-detail-copy.html?charger=' + encodeURIComponent(deviceID);
            }
        }

        // 返回上一页
        function goBack() {
            window.history.back();
        }

        // 菜单栏导航
        function navigateTo(page) {
            if (page === 'device') {
                // 当前已在设备详情页，不跳转
                return;
            } else if (page === 'search') {
                window.location.href = 'search.html';
            } else if (page === 'record') {
                window.location.href = 'records.html';
            } else if (page === 'me') {
                window.location.href = 'profile-3menu.html';
            }
        }

        // 断开设备连接
        function disconnectDevice() {
            const texts = i18n[savedLanguage];
            showDialog(
                texts.disconnectTitle,
                texts.disconnectMsg,
                texts.disconnect,
                function() {
                    executeDisconnect();
                },
                true  // 破坏性操作，使用红色
            );
        }

        // 执行断开连接
        function executeDisconnect() {
            // 如果正在充电，先停止充电
            if (isCharging) {
                if (chargingTimer) {
                    clearInterval(chargingTimer);
                    chargingTimer = null;
                }
            }

            // 清除充电状态
            localStorage.removeItem('chargingStatus');

            // 返回首页
            window.location.href = 'home.html';
        }
    </script>
</body>
</html>
